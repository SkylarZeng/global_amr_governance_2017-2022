# DID Sensitivity and Robustness Analysis
## Supplementary Figures S11-S14

This folder contains Stata code for Difference-in-Differences (DID) event-study analyses with multiple robustness specifications and outcome variables.

---

## Folder Structure

```
.
├── code/
│   ├── AMR_DID_control.do
│   ├── AMR_DID_covid.do
│   ├── AMR_DID_delete_covid.do
│   ├── AMR_DID_pm5.do
│   ├── AMU_DID_control.do
│   ├── AMU_DID_covid.do
│   ├── AMU_DID_delete_covid.do
│   ├── AMU_DID_pm5.do
│   ├── amrgbdAS_DID_control.do
│   ├── amrgbdAS_DID_covid.do
│   ├── amrgbdAS_DID_delete_covid.do
│   ├── amrgbdAS_DID_pm5.do
│   ├── amrgbdAT_DID_control.do
│   ├── amrgbdAT_DID_covid.do
│   ├── amrgbdAT_DID_delete_covid.do
│   └── amrgbdAT_DID_pm5.do
├── data/
│   ├── treatment_amr_control.dta
│   ├── treatment_amr_covid.dta
│   ├── treatment_amr.dta
│   ├── treatment_amu_control.dta
│   ├── treatment_amu_covid.dta
│   ├── treatment_amu.dta
│   ├── treatment_amrgbdAS_control.dta
│   ├── treatment_amrgbdAS_covid.dta
│   ├── treatment_amrgbdAS.dta
│   ├── treatment_amrgbdAT_control.dta
│   ├── treatment_amrgbdAT_covid.dta
│   └── treatment_amrgbdAT.dta
├── output/
│   └── [Results and figures generated by code]
└── README.md
```

---

## Outcome Variables

| Code | Description | Files |
|------|-------------|-------|
| **AMR** | Antimicrobial Resistance Prevalence | 4 files (control, covid, delete_covid, pm5) |
| **AMU** | Antimicrobial Use | 4 files (control, covid, delete_covid, pm5) |
| **amrgbdAS** | AMR Global Burden of Disease (Acute/Subacute) | 4 files (control, covid, delete_covid, pm5) |
| **amrgbdAT** | AMR Global Burden of Disease (Treated) | 4 files (control, covid, delete_covid, pm5) |

---

## Specification Types

### 1. **CONTROL** - Full Control Period Analysis
- **Data**: Full control period (all non-COVID years)
- **Covariates**: X1-X10 (full set)
- **Event Window**: ±11 years (K: -11 to +8)
- **Use Case**: Main DID analysis with all available covariates
- **Descriptive Statistics**: Full correlation matrix, pairwise correlations with significance tests, VIF diagnostics
- **Examples**: `AMR_DID_control.do`, `AMU_DID_control.do`, `amrgbdAS_DID_control.do`, `amrgbdAT_DID_control.do`

### 2. **COVID** - COVID Period Subsample (2020-2021)
- **Data**: Restricted to 2020-2021 only
- **Covariates**: X1 only (reduced specification)
- **Event Window**: ±11 years
- **Use Case**: Sensitivity test during pandemic period with limited covariates
- **Descriptive Statistics**: Reduced (Y, X1 only)
- **Examples**: `AMR_DID_covid.do`, `AMU_DID_covid.do`, `amrgbdAS_DID_covid.do`, `amrgbdAT_DID_covid.do`

### 3. **DELETE_COVID** - Excluding 2020-2021 (Sensitivity Test)
- **Data**: Full control period with 2020-2021 dropped
- **Covariates**: None (clean DID specification)
- **Event Window**: ±11 years
- **Use Case**: Robustness check excluding potential COVID disruptions
- **Descriptive Statistics**: Minimal
- **Examples**: `AMR_DID_delete_covid.do`, `AMU_DID_delete_covid.do`, `amrgbdAS_DID_delete_covid.do`, `amrgbdAT_DID_delete_covid.do`

### 4. **PM5** - ±5-Year Narrower Event Window
- **Data**: Full control period
- **Covariates**: None
- **Event Window**: ±5 years (K: -5 to +5 only)
- **Use Case**: Robustness check with narrower event window focusing on short-run effects
- **Descriptive Statistics**: Minimal
- **Examples**: `AMR_DID_pm5.do`, `AMU_DID_pm5.do`, `amrgbdAS_DID_pm5.do`, `amrgbdAT_DID_pm5.do`

---

## Methodological Approach

All 16 files implement the same event-study framework with **three complementary DID estimators**:

### **Method 1: Gardner Two-Stage DID** (did2s)
- Nonparametric event-study estimator for staggered treatment adoption
- First-stage: Unit and time fixed effects (with optional covariates)
- Second-stage: Event-time indicators (leads/lags)
- **Advantage**: Efficient handling of staggered treatment timing
- **Reference**: Gardner (2021)

### **Method 2: Stacked Event-Study DID** (stackedev)
- Creates a panel stack for each cohort at their treatment date
- Event-study coefficients from stacked regression
- Handles heterogeneous treatment effects across cohorts
- **Advantage**: Robust to heterogeneous timing and effect heterogeneity
- **Reference**: Cengiz et al. (2019)

### **Method 3: Traditional TWFE OLS** (reghdfe)
- Two-way fixed effects regression with cluster-robust standard errors
- Fixed effects: Units (i) and time periods (t)
- **Advantage**: Transparency and consistency checks across methods
- **Implementation**: High-dimensional fixed effects absorption

### **Sensitivity Analyses Conducted**
- We conducted a comprehensive set of sensitivity analyses to assess robustness of the results. Specifically, we
  - (i) applied heterogeneity-robust DID estimators (two-stage DID and stacked event-study DID) to mitigate biases arising from staggered adoption timing;
  - (ii) adjusted for an extensive set of baseline structural and health-system covariates (where specified) to control for pre-existing differences;
  - (iii) implemented three complementary approaches to address potential pandemic-era confounding (COVID-period restricted analyses, exclusion of 2020–2021, and placebo tests); and
  - (iv) restricted the temporal window in robustness checks to a ±5-year band around the adoption year to focus on short-run effects.

---

## Data Requirements

### Required Data Files
All `.dta` files must be in the `data/` subfolder. The code searches for them by name:
- `treatment_amr_control.dta` → For AMR control analyses
- `treatment_amr_covid.dta` → For AMR COVID analyses
- `treatment_amu_control.dta` → For AMU control analyses
- `treatment_amrgbdAS_control.dta` → For amrgbdAS control analyses
- etc.

### Data Structure
Each dataset must contain:
- `i`: Unit identifier (cross-sectional unit, e.g., country, region)
- `t`: Time period (year)
- `D`: Treatment indicator (binary: 1 = treated, 0 = control)
- `Y`: Outcome variable (original name differs by outcome, will be renamed to Y)
- `X1, X2, ..., X10`: Covariates (as applicable by specification)
- `treat_year`: Year of treatment adoption (for cohort identification)
- `no_treat`: Indicator for never-treated units

## Output Files

Each `.do` file generates the following outputs in the `output/` folder:

### Event-Study Estimates
- **Coefficient tables**: Point estimates with 95% confidence intervals
- **p-values**: Significance tests for each event-time indicator
- **Method comparison**: Parallel presentation of Gardner, Stacked, and TWFE estimates

### Visualizations
- **Main event plot**: Combined graph of all three methods
  - X-axis: Relative time to treatment (years: -11 to +8 or -5 to +5)
  - Y-axis: Estimated treatment effect
  - Lines colored by method
  - Confidence intervals shaded
  - File format: `.svg` (publication-ready)

### Robustness Test Results
- **Parallel trends**: F-statistic and p-value
- **Placebo test**: Coefficient estimates and confidence intervals

---

## Software Requirements

### Stata Packages Required
The code installs (or assumes pre-installation of) four essential packages:
1. **reghdfe** (Serrat, 2018): High-dimensional fixed effects estimation
2. **did2s** (Abraham & Sun, 2021): Two-stage DID for staggered adoption
3. **stackedev** (Cengiz et al., 2019): Stacked event-study DID
4. **event_plot** (Schmidheiny & Siegloch, 2019): Event-study visualization

### Installation
```stata
ssc install reghdfe, replace
ssc install did2s, replace
ssc install stackedev, replace
ssc install event_plot, replace
```

### Stata Version
- Developed and tested with **STATA18.0/SE**.
- Requires `gen Kc_8 = K if !missing(K)` syntax (Stata 13+).
- Uses extended macro functions and advanced fixed-effects commands.
- (See attached metadata/screenshot for the Stata build used in final runs.)

---

## Running the Analysis

### Single File Execution
```stata
* Set working directory
cd "/Users/skylar/Desktop/GOHIAMR/Data & code availability/Supplementary/Figure_S11_S14_DID_sensitivity_robustness_test"

* Run analysis
do code/AMR_DID_control.do
```

### Batch Execution (All 16 Files)
Create a master script (e.g., `run_all_analyses.do`):
```stata
* Run all 16 DID analyses
do code/AMR_DID_control.do
do code/AMR_DID_covid.do
do code/AMR_DID_delete_covid.do
do code/AMR_DID_pm5.do

do code/AMU_DID_control.do
do code/AMU_DID_covid.do
do code/AMU_DID_delete_covid.do
do code/AMU_DID_pm5.do

do code/amrgbdAS_DID_control.do
do code/amrgbdAS_DID_covid.do
do code/amrgbdAS_DID_delete_covid.do
do code/amrgbdAS_DID_pm5.do

do code/amrgbdAT_DID_control.do
do code/amrgbdAT_DID_covid.do
do code/amrgbdAT_DID_delete_covid.do
do code/amrgbdAT_DID_pm5.do
```

---

## Results Interpretation

### Main Coefficients
- **Positive coefficients (L-coefficients)**: Treatment increases outcome post-adoption
- **Negative coefficients (L-coefficients)**: Treatment decreases outcome post-adoption
- **Pre-treatment leads (F-coefficients)**: Should be statistically insignificant if parallel trends hold

### Statistical Significance
- 95% confidence intervals reported for all estimates
- p-values < 0.05 indicate significance at conventional level
- Consistent results across three methods strengthen causal inference

### Robustness Assessment
1. **Parallel Trends**: Non-rejection (p > 0.05) supports validity of comparison group
2. **Placebo Test**: Insignificant placebo estimates support causal interpretation
3. **COVID Sensitivity**: Consistent results with/without 2020-2021 years
4. **Event Window**: Consistent findings with ±5-year vs ±11-year windows

---

## Code Quality Features

✓ **All English documentation** - No Chinese text; publication-ready comments  
✓ **Streamlined package installation** - 4 essential packages only  
✓ **Standardized variable naming** - All outcomes renamed to Y for consistency  
✓ **Specification-dependent structure** - Covariates and event windows vary appropriately  
✓ **Three complementary methods** - Gardner, Stacked, TWFE for robustness  
✓ **Publication-quality figures** - SVG export with professional formatting  
✓ **Comprehensive robustness testing** - Parallel trends and placebo tests  
✓ **Consistent section headers** - Easy navigation and maintenance  

---

## Citation

If you use this code, please cite:

- **Gardner, J.** (2021). Two-Stage Differences in Differences. *SSRN Electronic Journal*. doi:10.2139/ssrn.3794018
- **Abraham, S., & Sun, L.** (2021). Estimating dynamic treatment effects in event studies with heterogeneous treatment effects. *Journal of Econometric Methods*, 10(1), 20190034.
- **Cengiz, D., Dube, A., Lindner, A., & Zipperer, B.** (2019). The effect of minimum wages on low-wage jobs. *Quarterly Journal of Economics*, 134(3), 1405-1454.

---

## Contact & Support

For questions about the analysis methodology, data structure, or code execution, contact the analysis team.

---
